<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- 适配刘海屏 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>长江珍稀物种的生命回响</title>
    
    <link rel="preload" as="image" href="bg.png">
    <link rel="preload" as="image" href="title.webp">

    <style>
        /* --- 基础设置 --- */
        :root {
            --bg-color: #F7F5F0;
            --river-color: #0277BD; 
            --text-primary: #2C3E50;
            --text-secondary: #555;
            --gold: #C5A059;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg-color);
            background-image: radial-gradient(#E0E0E0 1px, transparent 1px);
            background-size: 20px 20px;
            font-family: "Songti SC", "Noto Serif SC", "SimSun", serif;
            color: var(--text-primary);
            overflow-x: hidden;
            padding-bottom: 60px;
        }

        /* --- 独立层级定义 --- */
        .layer-hero-container {
            position: fixed;
            top: -20%; left: 0; width: 100%; height: 140%; 
            z-index: 0; pointer-events: none; will-change: transform;
        }

        .bg-hero-wrapper {
            position: absolute; top: 14.3%; left: 0; width: 100%; aspect-ratio: 4/3; 
        }

        .bg-hero-img {
            width: 100%; height: 100%;
            background-image: url('bg.png'); 
            background-size: cover; background-position: center; opacity: 0.9;
        }

        .layer-orbs-container {
            position: fixed; top: -20%; left: 0; width: 100%; height: 140%;
            z-index: 1; pointer-events: none; overflow: visible; will-change: transform;
        }

        .orb {
            position: absolute; border-radius: 50%; filter: blur(50px); 
            mix-blend-mode: normal !important; animation: float 10s ease-in-out infinite;
        }

        .orb-1 { width: 300px; height: 300px; background: #5C95E6; opacity: 0.4; top: 5%; left: -50px; animation-duration: 15s; }
        .orb-2 { width: 200px; height: 200px; background: #D4AF37; opacity: 0.4; top: 20%; right: -50px; animation-duration: 12s; }
        .orb-3 { width: 250px; height: 250px; background: #2E8B57; opacity: 0.4; top: 35%; left: 10%; animation-duration: 18s; }
        .orb-4 { width: 280px; height: 280px; background: #5C95E6; opacity: 0.4; top: 55%; right: -20px; animation-duration: 16s; }
        .orb-5 { width: 220px; height: 220px; background: #2E8B57; opacity: 0.4; top: 75%; left: -30px; animation-duration: 14s; }
        .orb-6 { width: 260px; height: 260px; background: #D4AF37; opacity: 0.3; top: 95%; right: 10%; animation-duration: 17s; }
        .orb-7 { width: 300px; height: 300px; background: #5C95E6; opacity: 0.4; top: 115%; left: -40px; animation-duration: 13s; }
        .orb-8 { width: 240px; height: 240px; background: #2E8B57; opacity: 0.4; top: 130%; right: -30px; animation-duration: 19s; }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(30px, -30px); }
        }

        header {
            position: relative; z-index: 2; padding: 180px 20px 30px; text-align: center;
        }

        .title-img {
            width: 90%; max-width: 340px; height: auto; margin: 0 auto 20px; display: block;
            animation: fadeInDown 1.2s cubic-bezier(0.22, 1, 0.36, 1);
            filter: drop-shadow(0 4px 10px rgba(0,0,0,0.1));
        }

        .intro-text {
            font-size: 15px; line-height: 1.8; color: var(--text-secondary); text-align: justify;
            max-width: 600px; margin: 0 auto; border: none; padding: 20px 24px;
            background: rgba(255, 255, 255, 0.4); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6); border-radius: 12px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.05); animation: fadeIn 1.5s ease-out;
        }

        .river-container {
            position: relative; width: 100%; max-width: 600px; 
            margin: 20px auto 0; padding-bottom: 20px; overflow: visible; z-index: 2;
        }

        @keyframes breathe-glow {
            0%, 100% { 
                filter: drop-shadow(0 0 2px rgba(2, 119, 189, 0.3)); stroke: #0277BD; stroke-width: 10;
            }
            50% { 
                filter: drop-shadow(0 0 8px rgba(79, 195, 247, 0.8)) drop-shadow(0 0 20px rgba(41, 182, 246, 0.5));
                stroke: #4FC3F7; stroke-width: 13; 
            }
        }
        
        @keyframes point-breathe {
            0%, 100% { border-color: #0277BD; box-shadow: 0 0 15px rgba(2, 119, 189, 0.5); }
            50% { border-color: #4FC3F7; box-shadow: 0 0 25px rgba(79, 195, 247, 0.9); }
        }

        .river-line {
            position: absolute; left: 50%; top: 80px; bottom: 120px; width: 120px; 
            transform: translateX(-50%); background-image: none; z-index: 0; 
        }

        .river-svg {
            width: 100%; height: 100%; overflow: visible; display: block;
        }

        .river-path {
            fill: none; stroke-linecap: round;
            animation: breathe-glow 2s ease-in-out infinite; will-change: stroke, stroke-width, filter;
        }

        .river-point {
            position: absolute; width: 14px; height: 14px; background: #fff;
            border: 3px solid var(--river-color); border-radius: 50%;
            box-shadow: 0 0 15px rgba(79, 195, 247, 0.8); z-index: 1;
            transform: translate(-50%, -50%); pointer-events: none;
            animation: point-breathe 2s ease-in-out infinite;
        }

        .episode-node {
            position: relative; width: 100%; display: flex; justify-content: center;
            margin-bottom: 40px; z-index: 2; opacity: 0; transform: translateY(50px); 
            transition: opacity 1s ease-out, transform 1s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .episode-node:nth-child(even) { transition-delay: 0.2s; }
        .episode-node.reveal { opacity: 1; transform: translateY(0); }

        .card {
            width: 88%; max-width: 400px; background: rgba(255, 255, 255, 0.8); 
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border-radius: 16px; box-shadow: 0 10px 40px -10px rgba(31, 38, 135, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.7); text-decoration: none; color: inherit;
            display: block; transition: transform 0.2s, box-shadow 0.2s; overflow: hidden; margin: 0 auto; 
            /* 关键：避免点击高亮背景色影响体验 */
            -webkit-tap-highlight-color: rgba(0,0,0,0);
        }
        
        .card:active { transform: scale(0.97); box-shadow: 0 4px 15px rgba(31, 38, 135, 0.08); }
        .card-content { padding: 16px 20px; text-align: left; }
        
        .ep-tag {
            display: flex; align-items: center; justify-content: flex-start; 
            font-size: 12px; color: var(--gold); font-weight: bold; letter-spacing: 1px;
            margin-bottom: 6px; text-shadow: 0 1px 0 rgba(255,255,255,0.8);
        }

        .card-img-wrapper {
            position: relative; width: 100%; padding-top: 56.25%;
            background: rgba(0,0,0,0.05); border-bottom: 1px solid rgba(255,255,255,0.5);
        }
        .card-img {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; transition: opacity 0.5s;
        }
        
        .play-icon {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 44px; height: 44px; background: rgba(255,255,255,0.3); backdrop-filter: blur(4px);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            border: 1px solid rgba(255,255,255,0.8); box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        .play-tri {
            width: 0; height: 0; border-left: 12px solid #fff;
            border-top: 8px solid transparent; border-bottom: 8px solid transparent; margin-left: 4px;
        }
        
        .city { display: block; font-size: 15px; color: var(--river-color); margin-bottom: 4px; font-weight: bold; }
        .title { font-size: 17px; line-height: 1.4; font-weight: bold; color: #1a1a1a; white-space: normal; word-wrap: break-word; }

        .click-ripple {
            position: fixed; border-radius: 50%; background: transparent;
            border: 2px solid rgba(2, 119, 189, 0.8); box-shadow: 0 0 12px rgba(2, 119, 189, 0.5);
            transform: scale(0); pointer-events: none; z-index: 9999;
            animation: ripple-refined 1s cubic-bezier(0.19, 1, 0.22, 1);
        }

        @keyframes ripple-refined {
            0% { transform: scale(0); opacity: 0.8; border-width: 4px; }
            100% { transform: scale(4); opacity: 0; border-width: 0px; }
        }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        footer {
            position: relative; z-index: 2; text-align: center; font-size: 12px;
            color: #888; margin-top: 10px; padding: 20px;
        }
    </style>
</head>
<body>

    <div class="layer-hero-container">
        <div class="bg-hero-wrapper"><div class="bg-hero-img"></div></div>
    </div>

    <div class="layer-orbs-container">
        <div class="orb orb-1"></div><div class="orb orb-2"></div><div class="orb orb-3"></div>
        <div class="orb orb-4"></div><div class="orb orb-5"></div><div class="orb orb-6"></div>
        <div class="orb orb-7"></div><div class="orb orb-8"></div>
    </div>

    <header>
        <img src="title.webp" alt="长江珍稀物种的生命回响" class="title-img" fetchpriority="high" onerror="this.style.display='none'; document.getElementById('fb-title').style.display='block'">
        <h1 id="fb-title" style="display:none; color:#2E5C55; margin-bottom:10px;">长江珍稀物种的生命回响</h1>
        <div class="intro-text">
            《长江珍稀物种的生命回响》记录了在“共抓大保护、不搞大开发”的理念指引下，长江沿线城市为珍稀物种重建家园、守护生命火种的行动。
            <br><br>
            该片聚焦长江上中下游的11个典型珍稀物种——如麋鹿、江豚、中华鲟等，通过讲述它们从濒危到种群恢复的故事，折射出人与自然关系的重塑。
        </div>
    </header>

    <div class="river-container" id="timeline">
        <div class="river-line" id="river-line-container">
            <!-- SVG 将通过 JS 插入 -->
        </div>
    </div>

    <footer><p>点击单集观看视频</p></footer>

    <script>
        const episodes = [
            { id: 1, city: "昌都", title: "守护“雪山精灵”", link: "http://www.gorgeousyichang.com/content-63329-3922-1.html" },
            { id: 2, city: "宜宾", title: "非同“鲟”常", link: "http://www.gorgeousyichang.com/content-63329-3927-1.html" },
            { id: 3, city: "铜仁", title: "梵净山的“精灵”", link: "http://www.gorgeousyichang.com/content-63329-3930-1.html" },
            { id: 4, city: "九龙坡", title: "以江为伴 与鹭同行", link: "http://www.gorgeousyichang.com/content-63329-3933-1.html" },
            { id: 5, city: "万州", title: "“蕨”处逢生", link: "http://www.gorgeousyichang.com/content-63329-3936-1.html" },
            { id: 6, city: "宜昌", title: "护鲟归江", link: "http://www.gorgeousyichang.com/content-63329-3939-1.html" },
            { id: 7, city: "荆州", title: "重回长江的麋鹿", link: "http://www.gorgeousyichang.com/content-63329-3941-1.html" },
            { id: 8, city: "长沙", title: "湘江再见“一抹红”", link: "http://www.gorgeousyichang.com/content-63329-3943-1.html" },
            { id: 9, city: "赣州", title: "在会昌深山遇见连片“植物界大熊猫”", link: "http://www.gorgeousyichang.com/content-63329-3943-1.html" },
            { id: 10, city: "安庆", title: "“长江微笑守望者”<br>——一个“豚爸”与江豚的故事", link: "http://www.gorgeousyichang.com/content-63329-3949-1.html" },
            { id: 11, city: "金华", title: "“森林卫士”的隐秘家园", link: "http://www.gorgeousyichang.com/content-63329-3952-1.html" },
            { id: 12, city: "泰州", title: "麋途", link: "http://www.gorgeousyichang.com/content-63329-3957-1.html" }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('timeline');
            
            // 生成卡片（标准的 <a href="..."> 跳转）
            if (container) {
                episodes.forEach((ep) => {
                    const node = document.createElement('div');
                    node.className = 'episode-node'; 
                    // 直接使用 a 标签包裹，href 指向目标链接，默认当前页跳转 (target="_self")
                    node.innerHTML = `
                        <a href="${ep.link}" class="card">
                            <div class="card-img-wrapper">
                                <img src="${ep.id}.jpg" alt="${ep.title}" class="card-img" loading="lazy">
                                <div class="play-icon"><div class="play-tri"></div></div>
                            </div>
                            <div class="card-content">
                                <div class="ep-tag">EP.${ep.id < 10 ? '0'+ep.id : ep.id}</div>
                                <span class="city">${ep.city}</span>
                                <div class="title">${ep.title.replace(ep.city + '：', '')}</div>
                            </div>
                        </a>
                    `;
                    container.appendChild(node);
                });
            }

            // --- 河流逻辑 ---
            const riverContainer = document.getElementById('river-line-container');
            let path; 
            let pathLength = 0;
            let maxDrawLength = 0;

            function initRiver() {
                riverContainer.innerHTML = '';
                const height = riverContainer.offsetHeight;
                if (height === 0) return; 

                const width = 120;
                const center = width / 2;
                
                let d = `M ${center} 0`;
                const idealWaveHeight = 300; 
                const steps = Math.round(height / idealWaveHeight) || 1;
                const waveHeight = height / steps; 

                for (let i = 0; i < steps; i++) {
                    let yStart = i * waveHeight;
                    let amp = 40; 
                    d += ` Q ${center + amp} ${yStart + waveHeight/4} ${center} ${yStart + waveHeight/2}`;
                    d += ` T ${center} ${yStart + waveHeight}`;
                }

                const ns = "http://www.w3.org/2000/svg";
                const svg = document.createElementNS(ns, "svg");
                svg.setAttribute("class", "river-svg");
                svg.setAttribute("viewBox", `0 0 ${width} ${height}`);
                svg.setAttribute("preserveAspectRatio", "none"); 

                path = document.createElementNS(ns, "path");
                path.setAttribute("class", "river-path");
                path.setAttribute("d", d);
                
                svg.appendChild(path);
                riverContainer.appendChild(svg);

                const startDot = document.createElement('div');
                startDot.className = 'river-point';
                startDot.style.left = '50%';
                startDot.style.top = '0%'; 
                riverContainer.appendChild(startDot);

                const endDot = document.createElement('div');
                endDot.className = 'river-point';
                endDot.style.left = '50%';
                endDot.style.top = '100%';
                riverContainer.appendChild(endDot);

                try {
                    pathLength = path.getTotalLength();
                    if (pathLength === 0) pathLength = height; 
                } catch(e) {
                    pathLength = height;
                }
                
                path.style.strokeDasharray = pathLength;
                path.style.strokeDashoffset = pathLength;
                
                updateDraw();
            }

            initRiver();

            function updateDraw() {
                if (!path || pathLength === 0) return;

                const scrollY = window.scrollY;
                const windowHeight = window.innerHeight;
                const bodyHeight = document.body.offsetHeight;
                const riverTop = riverContainer.getBoundingClientRect().top + scrollY;
                const drawTriggerPoint = scrollY + windowHeight * 0.75; 
                
                let currentDrawLength = drawTriggerPoint - riverTop;

                if ((window.innerHeight + scrollY) >= bodyHeight - 50) {
                     currentDrawLength = pathLength;
                }

                if (currentDrawLength < 0) currentDrawLength = 0;
                if (currentDrawLength > pathLength) currentDrawLength = pathLength;
                
                if (maxDrawLength > pathLength) maxDrawLength = pathLength;

                if (currentDrawLength > maxDrawLength) {
                    maxDrawLength = currentDrawLength;
                    path.style.strokeDashoffset = (pathLength - maxDrawLength).toFixed(2);
                }
            }

            const layerHero = document.querySelector('.layer-hero-container');
            const layerOrbs = document.querySelector('.layer-orbs-container');
            let ticking = false;

            window.addEventListener('scroll', () => {
                if (!ticking) {
                    window.requestAnimationFrame(() => {
                        const scrolled = window.scrollY;
                        if(layerHero) layerHero.style.transform = `translate3d(0, -${scrolled * 0.2}px, 0)`;
                        if(layerOrbs) layerOrbs.style.transform = `translate3d(0, -${scrolled * 0.2}px, 0)`;
                        updateDraw();
                        ticking = false;
                    });
                    ticking = true;
                }
            });

            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    maxDrawLength = 0; 
                    initRiver();
                }, 200);
            });

            window.addEventListener('load', () => {
                initRiver();
            });

            const observer = new IntersectionObserver((entries, obs) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('reveal');
                        obs.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.episode-node').forEach(node => observer.observe(node));
        });

        document.addEventListener('click', function(e) {
            // 如果点击的是链接，不做波纹动画，直接跳转
            if(e.target.closest('a')) return;

            const ripple = document.createElement('div');
            ripple.className = 'click-ripple';
            const size = 20; 
            ripple.style.width = size + 'px';
            ripple.style.height = size + 'px';
            ripple.style.left = (e.clientX - size/2) + 'px';
            ripple.style.top = (e.clientY - size/2) + 'px';
            document.body.appendChild(ripple);
            ripple.addEventListener('animationend', () => ripple.remove());
        });
    </script>
</body>
</html>